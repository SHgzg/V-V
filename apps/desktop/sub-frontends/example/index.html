<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¤ºä¾‹å­å‰ç«¯</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 30px;
    }

    .info {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 500;
      opacity: 0.8;
    }

    .info-value {
      font-family: 'Courier New', monospace;
      background: rgba(0, 0, 0, 0.2);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.9em;
    }

    .actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.2s;
      backdrop-filter: blur(10px);
    }

    button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      grid-column: span 2;
    }

    #log {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      max-height: 200px;
      overflow-y: auto;
    }

    .log-entry {
      padding: 4px 0;
      opacity: 0.9;
    }

    .log-entry.error {
      color: #ff6b6b;
    }

    .log-entry.success {
      color: #51cf66;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ V-V PKM å­å‰ç«¯ç¤ºä¾‹</h1>
    <p class="subtitle">è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­å‰ç«¯çª—å£ï¼Œä½¿ç”¨ BrowserWindow å®ç°</p>

    <div class="info">
      <div class="info-item">
        <span class="info-label">å­å‰ç«¯ ID:</span>
        <span class="info-value" id="frontend-id">-</span>
      </div>
      <div class="info-item">
        <span class="info-label">å¹³å°:</span>
        <span class="info-value" id="platform">-</span>
      </div>
      <div class="info-item">
        <span class="info-label">API å¯ç”¨:</span>
        <span class="info-value" id="api-status">æ£€æµ‹ä¸­...</span>
      </div>
    </div>

    <div class="actions">
      <button onclick="testGitStatus()">æµ‹è¯• Git çŠ¶æ€</button>
      <button onclick="openNewWindow()">æ‰“å¼€æ–°çª—å£</button>
      <button onclick="sendBroadcast()" class="secondary">å¹¿æ’­æ¶ˆæ¯åˆ°æ‰€æœ‰çª—å£</button>
    </div>

    <div id="log"></div>
  </div>

  <script>
    let logCount = 0

    // åˆå§‹åŒ–
    function init() {
      // æ£€æŸ¥ API æ˜¯å¦å¯ç”¨
      if (window.subFrontendAPI) {
        document.getElementById('frontend-id').textContent = window.subFrontendAPI.id
        document.getElementById('platform').textContent = window.subFrontendAPI.platform
        document.getElementById('api-status').textContent = 'âœ… å¯ç”¨'
        log('success', 'å­å‰ç«¯ API å·²åŠ è½½')
      } else {
        document.getElementById('api-status').textContent = 'âŒ ä¸å¯ç”¨'
        log('error', 'å­å‰ç«¯ API æœªæ‰¾åˆ°')
      }
    }

    // æ—¥å¿—å‡½æ•°
    function log(type, message) {
      const logDiv = document.getElementById('log')
      const entry = document.createElement('div')
      entry.className = `log-entry ${type}`
      entry.textContent = `[${logCount++}] ${new Date().toLocaleTimeString()} - ${message}`
      logDiv.insertBefore(entry, logDiv.firstChild)

      // ä¿æŒæ—¥å¿—æ•°é‡åœ¨åˆç†èŒƒå›´
      while (logDiv.children.length > 50) {
        logDiv.removeChild(logDiv.lastChild)
      }
    }

    // æµ‹è¯• Git çŠ¶æ€
    async function testGitStatus() {
      log('success', 'è°ƒç”¨ Git çŠ¶æ€ API...')

      try {
        const result = await window.subFrontendAPI.git.status({
          dir: 'D:\\\\project\\\\V-V'
        })
        log('success', `Git çŠ¶æ€: ${JSON.stringify(result).substring(0, 100)}...`)
      } catch (error) {
        log('error', `Git çŠ¶æ€å¤±è´¥: ${error.message}`)
      }
    }

    // æ‰“å¼€æ–°çª—å£
    async function openNewWindow() {
      const newId = `example-${Date.now()}`
      log('success', `æ‰“å¼€æ–°çª—å£: ${newId}`)

      // é€šè¿‡ä¸»è¿›ç¨‹æ‰“å¼€æ–°çª—å£
      // è¿™éœ€è¦åœ¨ Renderer Host ä¸­å®ç°
      log('success', 'è¯·ä» Renderer Host æ‰“å¼€æ–°çª—å£')
    }

    // å¹¿æ’­æ¶ˆæ¯
    async function sendBroadcast() {
      log('success', 'å¹¿æ’­æµ‹è¯•æ¶ˆæ¯åˆ°æ‰€æœ‰çª—å£')

      try {
        await window.subFrontendAPI.broadcast('test:message', {
          from: window.subFrontendAPI.id,
          timestamp: Date.now(),
          message: 'Hello from sub-frontend!'
        })
        log('success', 'å¹¿æ’­æ¶ˆæ¯å·²å‘é€')
      } catch (error) {
        log('error', `å¹¿æ’­å¤±è´¥: ${error.message}`)
      }
    }

    // ç›‘å¬æ¥è‡ªå…¶ä»–çª—å£çš„æ¶ˆæ¯
    if (window.subFrontendAPI) {
      window.subFrontendAPI.on('sub-frontend:message', (data) => {
        log('success', `æ”¶åˆ°æ¶ˆæ¯: ${JSON.stringify(data)}`)
      })
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', init)
  </script>
</body>
</html>
